apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: kubevirt-redfish
  namespace: openshift-gitops
  labels:
    {{- include "bootstrap.labels" . | nindent 4 }}  
spec:
  project: default
  source:
    repoURL: https://github.com/raffaelespazzoli/openshift-baremetal-lab.git
    targetRevision: HEAD
    path: charts/kubevirt-redfish
    helm:
      values: |
        route:
          enabled: true
          host: "kubevirt-redfish-kubevirt-redfish.apps.{{ .Values.clusterBaseDomain }}"
          tls:
            termination: "edge"
            insecureEdgeTerminationPolicy: "Redirect"

        server:
          host: "0.0.0.0"
          port: 8443
          tls:
            enabled: false

        datavolume:
          storage_size: "20Gi"
          allow_insecure_tls: true
          storage_class: ontap-san
          vm_update_timeout: "2m"
          iso_download_timeout: "30m"  

        chassis:
        {{ range $index, $_ := until (.Values.numStudents | int) -}}
          - name: "chassis-{{ add $index 1 }}"
            namespace: "bm-lab"
            service_account: "default"
            description: "My ocp-virt cluster with test VMs"
        {{- end }}
        authentication:
          users:
          {{ range $index, $_ := until (.Values.numStudents | int) -}}
            - username: "admin"
              password: "changeme"  # CHANGE THIS PASSWORD!
              chassis: ["chassis-{{ add $index 1 }}"]
          {{- end }}    
  destination:
    server: https://kubernetes.default.svc
    namespace: kubevirt-redfish